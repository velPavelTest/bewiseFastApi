# Тестовое задание FastApi получение вопросов.
Сервис наполняет свою БД вопросами из внешнего источника.

## Обзор:
### Worflow
* Отправить запрос на endpoint на добавление нужного числа вопросов в базу.

### Точки входа:
* http://localhost:8002/ - веб сервис
  * http://localhost:8002/docs - документация
  * http://localhost:8002/add_questions/ - api endpoint добавления вопросов.
* http://localhost:8080/ - веб интерфейс доступа к БД.

### Основные сущности
#### Вопрос
* ID - ID вопроса в БД приложения.
* origin_id - ID вопроса в источнике (откуда взяли). 
* source - источник вопроса.
* question_text - текст вопроса.
* answer - ответ на вопрос.
* create_datetime_origin - датавремя добавления вопроса в источник.
* create_datetime - датавремя добавления вопроса в БД приложения.

### Стек
* FastApi
* PostgreSQL
* SQLAlchemy
* Alembic

## Установка проекта
#### Установка через docker
* Установите docker-compose

* Склонируйте репозиторий с помощью git
 ```bash
git clone https://github.com/velPavelTest/bewiseFastApi.git
```

* Перейдите в папку проекта:
```bash
cd bewiseFastApi
```

* Измените логин-пароль к БД в файле .env

* Запуск и сборка контейнеров:
```bash
docker-compose up -d --build
```
**Готово**
* http://localhost:8002/docs - документация


## API
Ознакомиться с API можно в документации (ссылки выше).
На текущий момент все методы не требуют авторизации.
### Основные endpoints
##### add_questions/
* Post - нужно передать  {"questions_num": integer} - количество вопросов которые будут добавлены в БД. Допустимые значения questions_num от 1 до 999, рекомендуемые от 1 до 100 (ограничение провайдера вопросов). В случае успешного выполнения в базу будет добавлено указанное число новых уникальных вопросов, в ответе вернётся последний ранее(не в этот запрос) добавленный вопрос. В случае неудачи вернётся текст ошибки.

Пример запроса 
```
curl -X 'POST' \
  'http://localhost:8002/add_questions/' \
  -H 'accept: application/json' \
  -H 'Content-Type: application/json' \
  -d '{
  "questions_num": 5
}'
```

## Подключение к БД.
Выбирайте что вам больше нравится:
1. Открыть веб версию http://localhost:8080/
2. Подключиться к  БД в контейнере docker-compose exec db psql --username=bewise_db_user --dbname=bewise_db
3. Подключиться любимым клиентом на localhost:5432

## Критерии приёмки - check.
Некоторые пункты выполнены не в строгом соотвествии с тз. Помечены **modified done** с комментарием чем отличается. В реальном пректе обсуждалось бы с PM/BA/TL перед реализацией на этапе анализа ТЗ. Могут быть легко приведены в полное соотвествие с ТЗ. 
1. Docker-compose СУБД PostgreSQL, volume, инструкции подключения и развёртывания. **done**
2. Python FastApi
   1. Rest API post {"questions_num": integer} - **done**
   2. Запрос внешнего указанного сервиса questions_num вопросов. **done**
   3. Сохранение вопросов в БД.
      1. Сохранение колонок 1. ID вопроса, 2. Текст вопроса, 3. Текст ответа, 4. - Дата создания вопроса - **done**
      2. В случае неуникальности вопроса - дополнительные запросы пока не будет получен уникальный. **modified done** Добавлено ограничение на максимальное количество попыток получить уникальный вопрос.
      3. Ответом на запрос предыдущий сохранённый вопрос или пустой объект в случае отсутсвия. **modified done** Указанное в тз поведение реализована для случая успешного выполнения операции. В случае некорректного параметра или невозможности получить новые вопросы возвращается ошибка.
3. Инструкции и примеры
   1. Инструкция по сборке **done**
   2. пример запроса к postapi **done**
4.  Использование docker-compose, SqlAalchemy, аннотации типов. **done**